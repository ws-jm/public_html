// let python_files = [
//     {btn_name: "Python product1", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: true},
//     {btn_name: "Python product2", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: false},
//     {btn_name: "Python product3", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: true},
//     {btn_name: "Python product4", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: true},
//     {btn_name: "Python product5", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: true},
//     {btn_name: "Python product6", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: true},
//     {btn_name: "Python product6", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: true},
//     {btn_name: "Python product6", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: true},
//     {btn_name: "Python product6", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: true},
//     {btn_name: "Python product6", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: true},
//     {btn_name: "Python product6", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: true},
//     {btn_name: "Python product6", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: true},
//     {btn_name: "Python product6", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: true},
//     {btn_name: "Python product6", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: true},
//     {btn_name: "Python product7", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: true},
//     {btn_name: "Python product8", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: true},
//     {btn_name: "Python product9", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: true},
//     {btn_name: "Python product10", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: true}
// ];

// let r_files = [
//     {btn_name: "R product1", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: true},
//     {btn_name: "R product2", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: false},
//     {btn_name: "R product3", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: true},
//     {btn_name: "R product4", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: true},
//     {btn_name: "R product5", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: true},
//     {btn_name: "R product6", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: true},
//     {btn_name: "R product7", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: true},
//     {btn_name: "R product8", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: true},
//     {btn_name: "R product9", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: true},
//     {btn_name: "R product10", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: true}
// ]

// let jupyter_files = [
//     {btn_name: "Jupyter product1", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: false},
//     {btn_name: "Jupyter product2", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: false},
//     {btn_name: "Jupyter product3", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: true},
//     {btn_name: "Jupyter product4", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: true},
//     {btn_name: "Jupyter product5", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: true},
//     {btn_name: "Jupyter product6", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: true},
//     {btn_name: "Jupyter product7", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: true},
//     {btn_name: "Jupyter product8", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: true},
//     {btn_name: "Jupyter product9", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: true},
//     {btn_name: "Jupyter product10", description: "Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto, ut at vel cum sequi illo iste fugit accusamus explicabo tempore pariatur maxime ducimus asperiores nesciunt quidem, ex aut totam laudantium.", locked: true}
// ]

let select = document.querySelector('#language-select');
var per_num = 10;

var session = getSession();

// If the jupyter-list.json file axist then show the select option
$.ajax({
    url: 'analytic-demo/jupyter-list.json',
    type: 'GET',
    error: function (XMLHttpRequest, textStatus, errorThrown) {
        // functionNotificationMessage({
        //     text: 'There is an error at ' + this.url,
        //     type: 'error'
        // });
    },
    success: function () {
        let jupyterOption = `<option selected value="jupyter">Jupyter</option>`;
        $('#language-select').append(jupyterOption);
    }
});

// If the python-list.json file axist then show the select option
$.ajax({
    url: 'analytic-demo/python-list.json',
    type: 'GET',
    error: function (XMLHttpRequest, textStatus, errorThrown) {
        // functionNotificationMessage({
        //     text: 'There is an error at ' + this.url,
        //     type: 'error'
        // });
    },
    success: function () {
        let pythonOption = `<option value="python">Python</option>`;
        $('#language-select').append(pythonOption);
    }
});

// If the r-list.json file axist then show the select option
$.ajax({
    url: 'analytic-demo/r-list.json',
    type: 'GET',
    error: function (XMLHttpRequest, textStatus, errorThrown) {
        // functionNotificationMessage({
        //     text: 'There is an error at ' + this.url,
        //     type: 'error'
        // });
    },
    success: function () {
        let rOption = `<option value="r">R</option>`;
        $('#language-select').append(rOption);
    }
});


setTimeout(() => {
    show_grid($('#language-select').find("option:first-child").val(), per_num);
    accbtn();
},
200);


async function show_grid(selection, per_num = 3, sel_page = 1) {
    var data;
    if (selection == "jupyter") {
        data = await $.ajax({
            type: "GET",
            url: "analytic-demo/jupyter-list.json",
            dataType: "JSON",
            success: function (data) {

            },
            error: function (xhr) {
                functionNotificationMessage({
                    text: "The report list file for the jupyter demos cannot be found.",
                    type: 'error'
                });
            }
        });
    } else if (selection == "python") {
        data = await $.ajax({
            type: "GET",
            url: "analytic-demo/python-list.json",
            dataType: "JSON",
            success: function (data) {

            },
            error: function (xhr) {
                functionNotificationMessage({
                    text: "The report list file for the python demos cannot be found.",
                    type: 'error'
                });

            }
        });
    } else {
        data = await $.ajax({
            type: "GET",
            url: "analytic-demo/r-list.json",
            dataType: "JSON",
            success: function (data) {

            },
            error: function (xhr) {
                functionNotificationMessage({
                    text: "The report list file for the R demos cannot be found.",
                    type: 'error'
                });

            }
        });
    }

    var contents = $('<div>');
    var start = (sel_page - 1) * per_num;
    var end = (start + per_num) < data.length ? (start + per_num) : data.length;

    for (var i = start; i < end; i++) {
        var item = $('<div class="accordion-file">');
        var lock_img = (data[i].free_enabled || (!data[i].free_enabled && (session !== null && session !== "" && session !== undefined))) ? "unlocked.png" : "locked.png";

        var btn_active = ((data[i].free_enabled && data[i].filename != "") || (!data[i].free_enabled && (session !== null && session !== "" && session !== undefined) && data[i].filename != "")) ? "" : "disabled";
        
        var btn_session;
        if (session !== null && session !== "" && session !== undefined) {
            btn_session = '';
        } else {
            btn_session = 'disabled';
        }


        $('<button class="accordion-btn">' + data[i].report_name + ' <img src="resources/images/' + lock_img + '" alt=""></button>').appendTo(item);

        var item_contents = $('<div class="accordion-content">');

        $('<p>' + data[i].description + '</p>').appendTo(item_contents);

        var message = "";
        var filename = "";
        // var filecontents = "";
        if (btn_active == "") {
            try {
                await $.ajax({
                    type: "GET",
                    url: data[i].filename,
                    dataType: "text",
                    success: function (data) {
                        btn_active = "";
                        // filecontents = data;
                    },
                    error: function (xhr) {}
                });
            } catch (e) {
                btn_active = "disabled";
                btn_session = 'disabled';
                filename = data[i].filename.split("/");
                filename = filename[filename.length - 1]
                message = "The source file " + filename + " was not found"
            }
        } else {
            if (data[i].filename == "") {
                if (selection == "python") {
                    message = "The  Python samples report list was not found!";
                } else if (selection == "r") {
                    message = "The R samples report list was not found!";
                } else {
                    message = "The Jupyter samples report list was not found!";
                }
            }
        }

        $('<div class="btn-wrapper"><button class="btn ' + btn_active + ' btn-primary me-4" onclick="javascript:code_view(\'' + selection + '\', \'' + data[i].filename + '\', \'' + btn_active + '\');">View</button><button class="btn ' + btn_session + '  btn-success" onclick="javascript:download(\'' + data[i].filename + '\', \'' + btn_session + '\');" >Download</button><span style="margin:6px 0 0 30px; color:#aaa">' + message + '</span></div>').appendTo(item_contents);

        item_contents.appendTo(item);

        item.appendTo(contents);
    }


    if (selection == "python") {
        $('#python-body').html(contents);
    } else if (selection == "r") {
        $('#r-body').html(contents);
    } else {
        $('#jupyter-body').html(contents);
    }

    accbtn();
    pagination(selection, per_num, sel_page, data.length);
}

//When select option changes. it Means when user select other options
select.addEventListener("change", function () {
    let pyfiles = document.querySelector('.python-files');
    rfiles = document.querySelector('.r-files');
    jupfiles = document.querySelector('.jupyter-files');
    accordion = document.querySelector('.accordion-collapse')

    // When python is selected then hide jupyter files and R files
    if (select.value == 'python') {
        pyfiles.style.display = 'block';
        jupfiles.style.display = 'none';
        rfiles.style.display = 'none';
        show_grid("python", per_num);
    }

    // When R is selected then hide jupyter files and Python files. Show R files
    else if (select.value == 'r') {
        rfiles.style.display = 'block';
        pyfiles.style.display = 'none';
        jupfiles.style.display = 'none';
        show_grid("r", per_num);
    }

    // And when Jupyter is selected then hide Python files and R files.Show Jupyter files
    else if (select.value == 'jupyter') {
        jupfiles.style.display = 'block';
        pyfiles.style.display = 'none';
        rfiles.style.display = 'none';
        show_grid("jupyter", per_num);
    }
});

//this is the accordion button
function accbtn() {
    let accbtn = document.getElementsByClassName("accordion-btn");
    for (let i = 0; i < accbtn.length; i++) {
        //when one of the buttons are clicked run this function
        accbtn[i].onclick = function () {
            //letiables
            let panel = this.nextElementSibling;
            let accContent = document.getElementsByClassName("accordion-content");
            let accActive = document.getElementsByClassName("accordion-btn active");

            /*if pannel is already open - minimize*/
            if (panel.style.maxHeight) {
                //minifies current pannel if already open
                panel.style.maxHeight = null;
                //removes the 'active' class as toggle didnt work on browsers minus chrome
                this.classList.remove("active");
            } else { //pannel isnt open...
                //goes through the buttons and removes the 'active' css (+ and -)
                for (let ii = 0; ii < accActive.length; ii++) {
                    accActive[ii].classList.remove("active");
                }
                //Goes through and removes 'activ' from the css, also minifies any 'panels' that might be open
                for (let iii = 0; iii < accContent.length; iii++) {
                    this.classList.remove("active");
                    accContent[iii].style.maxHeight = null;
                }
                //opens the specified pannel
                panel.style.maxHeight = panel.scrollHeight + "px";
                //adds the 'active' addition to the css.
                this.classList.add("active");
            }
        } //closing to the acc onclick function
    } //closing to the for loop.
}

// form validation check
let sendtBtn = document.querySelector('.send-btn');

sendtBtn.addEventListener('click', function () {
    let nameInput = document.querySelector('.name input');
    companyInput = document.querySelector('.company input');
    messageInput = document.querySelector('.message textarea');

    if (nameInput.value.length < 3) { //if name inputs value is less then 3 character
        // then show the error text
        nameInput.nextElementSibling.style.display = 'block'

    } else if (nameInput.value.length > 3) { //if name inputs value is greater then 3 character
        nameInput.nextElementSibling.style.display = 'none' // then hide the error text
    }
    if (companyInput.value.length < 3) { //if company inputs value is less then 3 character
        companyInput.nextElementSibling.style.display = 'block' // then show the error text

    } else if (companyInput.value.length > 3) { //if Company inputs value is greater then 3 character
        companyInput.nextElementSibling.style.display = 'none' // then hide the error text
    }
    if (messageInput.value.length < 10) { //if message inputs value is less then 3 character
        messageInput.nextElementSibling.style.display = 'block' // then show the error text

    } else if (messageInput.value.length > 10) { //if Company inputs value is greater then 3 character
        messageInput.nextElementSibling.style.display = 'none' // then hide the error text
    }

})

function pagination(selection, per_num = 3, sel_page = 1, dataRows) {
    total_page = Math.ceil(dataRows / per_num);
    var pagi = $('<ul class="pagination">');
    var prev = (sel_page == 1) ? "disabled" : "";
    $('<li class="page-item ' + prev + '"><a class="page-link" href="javascript:show_grid(\'' + selection + '\', ' + per_num + ', ' + (sel_page - 1) + ')">Prev</a></li>').appendTo(pagi);
    for (var i = 1; i <= total_page; i++) {
        if (i == sel_page)
            $('<li class="page-item active"><a class="page-link">' + i + '</a></li>').appendTo(pagi);
        else
            $('<li class="page-item"><a class="page-link" href="javascript:show_grid(\'' + selection + '\', ' + per_num + ', ' + i + ')">' + i + '</a></li>').appendTo(pagi);
    }
    var next = (sel_page == total_page) ? "disabled" : "";
    $('<li class="page-item ' + next + '"><a class="page-link" href="javascript:show_grid(\'' + selection + '\', ' + per_num + ', ' + (sel_page + 1) + ')">Next</a></li>').appendTo(pagi);

    if (selection == "python") {
        $('#python_pagination').html(pagi);
    } else if (selection == "r") {
        $('#r_pagination').html(pagi);
    } else {
        $('#jupyter_pagination').html(pagi);
    }
}

function code_view(selection, url, btn_active) {
    if (btn_active != 'disabled') {
        if (selection == "jupyter") {
            msg = "View  the  source file in a web page?";
            dialogWindow(msg, 'query', 'confirm', 'Report Viewer',
                function () {
                    window.open("code_viewer?filetype=" + selection + "&url=" + url, '_blank');
                }, null, null, {
                    Ok: 'Yes',
                    Cancel: 'No'
                }
            )
        } else {
            msg = "View  the  source file in a web page?";
            // msg = "<input type='radio'/>asd<input type='radio'/>asd";
            dialogWindow(msg, 'query', 'confirm', 'Report Viewer',
                function () {
                    window.open("code_viewer?filetype=" + selection + "&url=" + url, '_blank');
                }, null, null, {
                    Ok: 'Yes',
                    Cancel: 'No'
                }
            )
        }
    }
}

function download(url, btn_active) {
    // msg = "View  the  source file in a web page?";
    // dialogWindow(msg, 'query', 'confirm', null,
    //     function () {
    if (btn_active != 'disabled') {
        filename = url.split("/");
        filename = filename[filename.length - 1]
        axios({
                url: url,
                method: 'GET',
                responseType: 'blob'
            })
            .then((response) => {
                const url = window.URL
                    .createObjectURL(new Blob([response.data]));
                const link = document.createElement('a');
                link.href = url;
                link.setAttribute('download', filename);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            })
    }
    //     }, null, null, { Ok: 'Yes', Cancel: 'No' }
    // )


}